<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подтверждение перехода по ссылкам</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        #contents {
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f9fa;
        }

        .link {
            display: block;
            margin: 10px 0;
            padding: 8px;
            background-color: #e8f4fc;
            border-radius: 4px;
        }

        .status {
            margin-top: 20px;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 4px;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .note {
            font-size: 0.9em;
            color: #666;
            margin-top: 20px;
            padding: 10px;
            background-color: #fff8dc;
            border-left: 4px solid #f0c040;
        }
    </style>
</head>
<body>
<h1>Подтверждение перехода по ссылкам</h1>

<p>Эта страница демонстрирует обработку кликов по ссылкам с использованием делегирования событий.</p>

<div style="display: none" class="note">
    <strong>Важно:</strong> Содержимое блока ниже может быть загружено динамически через innerHTML.
    Обработчик события назначен на контейнер и использует делегирование для обработки кликов по ссылкам.
</div>

<div id="contents">
    <!-- Содержимое будет загружено динамически -->
</div>

<div class="status" id="status">
    Статус: Ожидание действий...
</div>

<div>
    <button id="loadContent1">Загрузить содержимое (вариант 1)</button>
    <button id="loadContent2">Загрузить содержимое (вариант 2)</button>
    <button id="clearContent">Очистить содержимое</button>
</div>

<script>
    // Получаем элементы
    const contents = document.getElementById('contents');
    const status = document.getElementById('status');

    // Варианты содержимого для демонстрации
    const contentVariants = {
        variant1: `
                <h2>Ссылки для проверки</h2>
                <p>Кликните по любой ссылке ниже. Вам будет предложено подтвердить переход.</p>

                <div class="link">
                    <a href="https://www.google.com" target="_blank">
                        <i>Перейти в Google</i>
                    </a>
                </div>

                <div class="link">
                    <a href="https://www.github.com">
                        <strong>GitHub</strong> - платформа для разработчиков
                    </a>
                </div>

                <div class="link">
                    <span>Это не ссылка, а обычный текст. </span>
                    <a href="https://ru.wikipedia.org">
                        <span>А это ссылка на <em>Википедию</em></span>
                    </a>
                </div>

                <div class="link">
                    <a href="https://example.com">
                        <div>
                            <h3>Пример сложной ссылки</h3>
                            <p>Эта ссылка содержит несколько вложенных элементов</p>
                        </div>
                    </a>
                </div>

                <p>Также есть <a href="https://stackoverflow.com">ссылка внутри текста</a>, которая тоже будет обработана.</p>
            `,

        variant2: `
                <h2>Другой набор ссылок</h2>
                <p>Это демонстрация того, что содержимое может быть динамически заменено.</p>

                <div class="link">
                    <a href="https://news.ycombinator.com">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0iIzMzMyI+PGNpcmNsZSBjeD0iOCIgY3k9IjgiIHI9IjciLz48L3N2Zz4=" alt="icon" style="width:16px; height:16px; vertical-align:middle;">
                        Hacker News
                    </a>
                </div>

                <div class="link">
                    <a href="https://www.youtube.com">
                        <span style="color:red;">YouTube</span> - видео платформа
                    </a>
                </div>

                <ul>
                    <li>Пункт без ссылки</li>
                    <li><a href="https://reactjs.org">React - библиотека для UI</a></li>
                    <li><a href="https://vuejs.org">Vue.js - прогрессивный фреймворк</a></li>
                </ul>

                <div>
                    <p>Вложенная структура:
                        <span>
                            <a href="https://angular.io">Angular</a> внутри нескольких тегов
                        </span>
                    </p>
                </div>
            `
    };

    // Функция для загрузки содержимого
    function loadContent(content) {
        contents.innerHTML = content;
        status.textContent = 'Статус: Содержимое загружено. Кликните по любой ссылке.';
    }

    // Функция для очистки содержимого
    function clearContent() {
        contents.innerHTML = '';
        status.textContent = 'Статус: Содержимое очищено. Загрузите новый вариант.';
    }

    // Назначаем обработчики на кнопки
    document.getElementById('loadContent1').addEventListener('click', () => {
        loadContent(contentVariants.variant1);
    });

    document.getElementById('loadContent2').addEventListener('click', () => {
        loadContent(contentVariants.variant2);
    });

    document.getElementById('clearContent').addEventListener('click', clearContent);

    // Делегирование события клика на элементе #contents
    contents.addEventListener('click', function(event) {
        // Используем closest для поиска ближайшего родительского элемента <a>
        // Это работает даже если клик был на вложенном элементе внутри ссылки
        const link = event.target.closest('a');

        // Если клик был не по ссылке, выходим из функции
        if (!link) return;

        // Получаем URL ссылки
        const url = link.href;

        // Спрашиваем пользователя о подтверждении перехода
        const userConfirmed = confirm(`Вы действительно хотите перейти по ссылке?\n\n${url}\n\nНажмите "OK" для перехода или "Отмена" чтобы остаться на странице.`);

        // Если пользователь не подтвердил, отменяем переход
        if (!userConfirmed) {
            event.preventDefault(); // Отменяем стандартное действие
            event.stopPropagation(); // Останавливаем всплытие события

            // Обновляем статус
            status.textContent = `Статус: Переход по ссылке отменен пользователем. (${url})`;

            // Небольшая визуальная обратная связь
            link.style.backgroundColor = '#ffe6e6';
            setTimeout(() => {
                link.style.backgroundColor = '';
            }, 500);

            return false;
        }

        // Если пользователь подтвердил, позволяем переходу произойти
        // Можно добавить здесь дополнительную логику перед переходом
        status.textContent = `Статус: Переход по ссылке разрешен. (${url})`;

        // Если ссылка ведет на внешний ресурс, можно открыть ее в новой вкладке
        // Но это нарушит стандартное поведение, поэтому оставляем как есть
        // Для демонстрации просто разрешаем переход
    });

    // Также обрабатываем событие contextmenu (правый клик) чтобы предотвратить
    // обход подтверждения через "Открыть ссылку в новой вкладке"
    contents.addEventListener('contextmenu', function(event) {
        const link = event.target.closest('a');
        if (!link) return;

        // Можно также спросить подтверждение для правого клика,
        // но обычно это раздражает пользователей, поэтому просто покажем сообщение
        status.textContent = 'Статус: Используйте левую кнопку мыши для перехода по ссылкам с подтверждением.';
    });

    // Инициализация: загружаем первый вариант содержимого
    loadContent(contentVariants.variant1);
</script>
</body>
</html>